# Руководство пользователя для бэкенд-сервиса MedAnalyzer

## Введение

Этот документ предоставляет краткое руководство по настройке, запуску и использованию бэкенд-сервиса MedAnalyzer. Сервис предназначен для анализа симптомов с использованием внешних API (RapidAPI "AI Medical Diagnosis API" и Google Gemini Flash 2.5 API) и предоставления предварительной оценки, возможных причин и рекомендаций.

## Предварительные требования

Для работы с бэкенд-сервисом вам потребуется:

*   **Node.js** (рекомендуется LTS-версия)
*   **npm** (обычно поставляется вместе с Node.js)

## Переменные окружения

Для корректной работы сервиса необходимо настроить следующие переменные окружения:

*   `RAPIDAPI_KEY`: Ваш ключ API для RapidAPI "AI Medical Diagnosis API".
*   `GEMINI_API_KEY`: Ваш ключ API для Google Gemini Flash 2.5 API.

Создайте файл `.env.local` в корневой директории `medanalyzer-service` и добавьте в него эти переменные:

```
RAPIDAPI_KEY=ВАШ_RAPIDAPI_КЛЮЧ
GEMINI_API_KEY=ВАШ_GEMINI_КЛЮЧ
```

## Установка

Перейдите в директорию `medanalyzer-service` и установите все необходимые зависимости:

```bash
cd medanalyzer-service
npm install
```

## Запуск

Для запуска бэкенд-сервиса в режиме разработки используйте следующую команду:

```bash
npm run dev
```

Сервис будет доступен по адресу `http://localhost:3000` (или другому порту, если он указан в конфигурации Next.js).

## Описание API Endpoint

### `/api/analyze`

Этот эндпоинт принимает данные о симптомах пациента, отправляет их во внешние медицинские API и возвращает структурированный анализ.

*   **Метод:** `POST`
*   **URL:** `/api/analyze`
*   **Content-Type:** `application/json`

#### Тело запроса (JSON)

| Поле              | Тип    | Описание                                                              | Пример        |
| :---------------- | :----- | :-------------------------------------------------------------------- | :------------ |
| `age`             | Number | Возраст пациента                                                      | `30`          |
| `gender`          | String | Пол пациента (`male` или `female`)                                    | `"male"`      |
| `mainComplaint`   | String | Основная жалоба пациента                                              | `"головная боль"` |
| `additionalSymptoms` | Array  | Массив дополнительных симптомов (строки)                              | `["тошнота", "головокружение"]` |
| `duration`        | String | Длительность симптомов (например, "2 дня", "неделя", "несколько часов") | `"2 дня"`     |

#### Пример запроса с использованием `curl`

```bash
curl -X POST http://localhost:3000/api/analyze \
-H "Content-Type: application/json" \
-d '{
    "age": 35,
    "gender": "female",
    "mainComplaint": "сильная усталость",
    "additionalSymptoms": ["слабость", "сонливость"],
    "duration": "1 неделя"
}'
```

#### Пример успешного ответа (JSON)

```json
{
  "preliminaryAssessment": "Предварительная оценка ситуации на 1-2 предложения.",
  "possibleCauses": [
    "Возможная причина 1",
    "Возможная причина 2"
  ],
  "urgencyLevel": "Средняя: Требуется консультация специалиста в ближайшее время.",
  "recommendations": [
    "Общая рекомендация 1",
    "Общая рекомендация 2"
  ],
  "doctorRecommendation": "Обратитесь к терапевту для первичной консультации.",
  "disclaimer": "Этот анализ не является медицинским диагнозом. Для точной диагностики и лечения обратитесь к врачу."
}
```

#### Обработка ошибок

В случае ошибки сервер вернет статус `500` и JSON-объект с полем `error` и, возможно, `details`:

```json
{
  "error": "Failed to analyze symptoms",
  "details": "Сообщение об ошибке от внешнего API или внутренняя ошибка сервера."
}
